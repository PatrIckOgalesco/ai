<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/addons/p5.sound.min.js"></script>
    <script src="https://unpkg.com/ml5@0.5.0/dist/ml5.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <title>VisionVoyager</title>
    <style>
        body {
            background: linear-gradient(90deg, var(--dark) 31px, transparent 1px) 50%, linear-gradient(180deg, var(--dark) 31px, var(--grey) 1px) 50%;
            background-size: 32px 32px;
            color: var(--dark);
            margin: 0; /* Remove default margin */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 100%;
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
<main>
    <script>
        let video;
let detector;
let detections = [];
let stableDetections = [];

function preload() {
    detector = ml5.objectDetector('cocossd');
}

function gotDetections(error, results) {
    if (error) {
        console.error(error);
    }
    detections = results;
    detector.detect(video, gotDetections);
}

function setup() {
    createCanvas(1080, 480); // Set a fixed canvas size
    video = createCapture(VIDEO);
    video.size(1080, 480); // Set the video size
    video.hide();
    frameRate(30); // Set the frame rate to 30 frames per second
    detector.detect(video, gotDetections);
}

function draw() {
    image(video, 0, 0, width, height);

    for (let i = 0; i < detections.length; i++) {
        let object = detections[i];
        let label = object.label;
        let confidence = nf(object.confidence * 100, 0, 1); // Convert confidence to a percentage

        let boxColor;

        // Assign colors and labels based on object type
        if (label === 'person') {
            boxColor = color('#00ff00'); // Green for "person"
        } else if (label === 'car' || label === 'bus' || label === 'truck' || label === 'motorcycle') {
            boxColor = color('#ff0000'); // Red for "any vehicles"
        } else if (label === 'unknown') {
            boxColor = color('#ffff00'); // Yellow for "unknown"
            label = 'unknown'; // Update label to "unknown"
        } else {
            boxColor = color('#00ddff'); // Default color for other objects
        }

        let stableObject = stableDetections[i] || object; // Interpolate current position with the previous position
        stableObject.x = lerp(stableObject.x, object.x, 0.2);
        stableObject.y = lerp(stableObject.y, object.y, 0.2);

        stroke(boxColor); // Draw the stable detection box with label and confidence score
        strokeWeight(4);
        noFill();
        rect(stableObject.x, stableObject.y, object.width, object.height);
        noStroke();
        fill(255);
        textSize(24);
        text(`${label} (${confidence}%)`, stableObject.x + 10, stableObject.y + 24);

        stableDetections[i] = stableObject; // Update stable detections
    }
}

    </script>
    <div class="info-wrapper">
    <div class="info-toggle">
        <i class='bx bxs-info-circle'></i>
    </div>
    <div class="info-ml-wrapper">
        <div class="info-ml-content">
            <p class="info-ml-no-ml">
                Voyager: Detection with COCO-SSD" <br><br>Voyager is an innovative web-based project that leverages the power of COCO-SSD (Common Objects in Context - Single Shot MultiBox Detector) for real-time object detection. This project combines cutting-edge computer vision technology with user-friendly web access to enable accurate and efficient object detection tasks.<br><br>

                COCO-SSD:<br>Is available as pre-trained model that can be used by developers and researchers for various computer vision tasks. Many machine learning frameworks and libraries offer APIs and tools to work with COCO-SSD, making it accessible and practical for a wide range of applications.<br>
            </p>
        </div>
    </div>
</div>
</main>
<script src="script.js"></script>
</body>
</html>